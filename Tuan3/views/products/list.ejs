<%- include('../layout', {title: typeof title !== 'undefined' ? title : 'Danh s√°ch s·∫£n ph·∫©m'}) %>
<style>
  /* Header v·ªõi user info */
  .user-info {
    display: flex;
    justify-content: space-between;
    align-items: center;
    margin-bottom: 20px;
    padding: 15px;
    background: #f5f5f5;
    border-radius: 5px;
  }

  .user-info span {
    color: #666;
  }

  .user-info a {
    color: #1976d2;
    text-decoration: none;
    margin-left: 10px;
  }

  /* Filter section */
  .filter-section {
    background: white;
    padding: 20px;
    border-radius: 8px;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
    margin-bottom: 20px;
  }

  .filter-section h3 {
    margin-bottom: 15px;
    color: #333;
  }

  .filter-form {
    display: grid;
    grid-template-columns: repeat(auto-fit, minmax(200px, 1fr));
    gap: 15px;
    margin-bottom: 15px;
  }

  .filter-group {
    display: flex;
    flex-direction: column;
  }

  .filter-group label {
    margin-bottom: 5px;
    font-weight: 600;
    color: #666;
    font-size: 0.9em;
  }

  .filter-group input,
  .filter-group select {
    padding: 8px;
    border: 2px solid #e0e0e0;
    border-radius: 5px;
    font-size: 14px;
  }

  .filter-actions {
    display: flex;
    gap: 10px;
  }

  /* Table */
  .table-container {
    overflow-x: auto;
    margin-top: 20px;
  }

  table {
    width: 100%;
    border-collapse: collapse;
    background: white;
    box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1);
  }

  thead {
    background: #1976d2;
    color: white;
  }

  th {
    padding: 15px;
    text-align: left;
    font-weight: 600;
    text-transform: uppercase;
    font-size: 0.9em;
    letter-spacing: 0.5px;
  }

  td {
    padding: 15px;
    border-bottom: 1px solid #e0e0e0;
  }

  tbody tr:hover {
    background: #f8f9fa;
  }

  tbody tr:last-child td {
    border-bottom: none;
  }

  .product-image {
    width: 80px;
    height: 80px;
    object-fit: cover;
    border-radius: 8px;
    box-shadow: 0 2px 5px rgba(0, 0, 0, 0.1);
  }

  .product-name {
    font-weight: 600;
    color: #333;
  }

  .product-price {
    color: #1976d2;
    font-weight: 600;
    font-size: 1.1em;
  }

  .product-quantity {
    color: #666;
  }

  /* Inventory status badge */
  .inventory-badge {
    display: inline-block;
    padding: 4px 12px;
    border-radius: 12px;
    font-size: 0.85em;
    font-weight: 600;
  }

  .inventory-badge.in_stock {
    background: #c8e6c9;
    color: #2e7d32;
  }

  .inventory-badge.low_stock {
    background: #ffe0b2;
    color: #e65100;
  }

  .inventory-badge.out_of_stock {
    background: #ffcdd2;
    color: #c62828;
  }

  .actions {
    display: flex;
    gap: 10px;
    justify-content: center;
  }

  .empty-state {
    text-align: center;
    padding: 60px 20px;
    color: #666;
  }

  .empty-state h2 {
    margin-bottom: 20px;
    color: #333;
  }

  /* Pagination */
  .pagination {
    display: flex;
    justify-content: center;
    gap: 10px;
    margin-top: 20px;
    padding: 20px;
  }

  .pagination a,
  .pagination span {
    padding: 8px 16px;
    border: 1px solid #e0e0e0;
    border-radius: 5px;
    text-decoration: none;
    color: #1976d2;
  }

  .pagination span {
    color: #666;
    background: #f5f5f5;
  }

  .pagination a:hover {
    background: #e3f2fd;
  }

  @media (max-width: 768px) {
    table {
      font-size: 0.9em;
    }

    th, td {
      padding: 10px 8px;
    }

    .product-image {
      width: 60px;
      height: 60px;
    }

    .filter-form {
      grid-template-columns: 1fr;
    }
  }
</style>

<div class="user-info">
  <div>
    <% if (typeof user !== 'undefined' && user) { %>
      <span>üë§ <strong><%= user.username %></strong> (<%= user.role === 'admin' ? 'Qu·∫£n tr·ªã vi√™n' : 'Nh√¢n vi√™n' %>)</span>
      <a href="/logout">ƒêƒÉng xu·∫•t</a>
    <% } else { %>
      <a href="/login">ƒêƒÉng nh·∫≠p</a>
    <% } %>
  </div>
  <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
    <div>
      <a href="/categories" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">üìÅ Qu·∫£n l√Ω danh m·ª•c</a>
      <a href="/users" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">üë• Qu·∫£n l√Ω user</a>
    </div>
  <% } %>
</div>

<div class="page-header">
  <h2>üìã Danh s√°ch s·∫£n ph·∫©m</h2>
  <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
    <a href="/create" class="btn">‚ûï Th√™m s·∫£n ph·∫©m m·ªõi</a>
  <% } %>
</div>

<!-- Filter Section -->
<div class="filter-section">
  <h3>üîç T√¨m ki·∫øm & L·ªçc</h3>
  <form method="GET" action="/" class="filter-form">
    <div class="filter-group">
      <label for="name">T√™n s·∫£n ph·∫©m</label>
      <input type="text" id="name" name="name" value="<%= typeof filters !== 'undefined' && filters.name ? filters.name : '' %>" placeholder="Nh·∫≠p t√™n s·∫£n ph·∫©m">
    </div>

    <div class="filter-group">
      <label for="categoryId">Danh m·ª•c</label>
      <select id="categoryId" name="categoryId">
        <option value="">-- T·∫•t c·∫£ --</option>
        <% if (typeof categories !== 'undefined' && categories) { %>
          <% categories.forEach(cat => { %>
            <option value="<%= cat.categoryId %>" <%= typeof filters !== 'undefined' && filters.categoryId === cat.categoryId ? 'selected' : '' %>><%= cat.name %></option>
          <% }) %>
        <% } %>
      </select>
    </div>

    <div class="filter-group">
      <label for="minPrice">Gi√° t·ªëi thi·ªÉu (VNƒê)</label>
      <input type="number" id="minPrice" name="minPrice" value="<%= typeof filters !== 'undefined' && filters.minPrice ? filters.minPrice : '' %>" placeholder="0" min="0">
    </div>

    <div class="filter-group">
      <label for="maxPrice">Gi√° t·ªëi ƒëa (VNƒê)</label>
      <input type="number" id="maxPrice" name="maxPrice" value="<%= typeof filters !== 'undefined' && filters.maxPrice ? filters.maxPrice : '' %>" placeholder="999999999" min="0">
    </div>

    <div class="filter-actions">
      <button type="submit" class="btn">üîç T√¨m ki·∫øm</button>
      <a href="/" class="btn btn-secondary">üîÑ X√≥a b·ªô l·ªçc</a>
    </div>
  </form>
</div>

<% if (products.length === 0) { %>
  <div class="empty-state">
    <h2>Kh√¥ng t√¨m th·∫•y s·∫£n ph·∫©m n√†o</h2>
    <p>H√£y th·ª≠ thay ƒë·ªïi b·ªô l·ªçc ho·∫∑c th√™m s·∫£n ph·∫©m m·ªõi!</p>
    <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
      <a href="/create" class="btn" style="margin-top: 20px;">Th√™m s·∫£n ph·∫©m</a>
    <% } %>
  </div>
<% } else { %>
  <div class="table-container">
    <table>
      <thead>
        <tr>
          <th>H√¨nh ·∫£nh</th>
          <th>T√™n s·∫£n ph·∫©m</th>
          <th>Danh m·ª•c</th>
          <th>Gi√° (VNƒê)</th>
          <th>S·ªë l∆∞·ª£ng</th>
          <th>Tr·∫°ng th√°i</th>
          <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
            <th>Thao t√°c</th>
          <% } %>
        </tr>
      </thead>
      <tbody>
        <% products.forEach(p => { %>
          <tr>
            <td>
              <img src="<%= p.url_image %>" alt="<%= p.name %>" class="product-image" />
            </td>
            <td class="product-name"><%= p.name %></td>
            <td>
              <% if (p.categoryId && typeof categories !== 'undefined' && categories) { %>
                <% const cat = categories.find(c => c.categoryId === p.categoryId); %>
                <%= cat ? cat.name : 'N/A' %>
              <% } else { %>
                N/A
              <% } %>
            </td>
            <td class="product-price"><%= new Intl.NumberFormat('vi-VN').format(p.price) %> ‚Ç´</td>
            <td class="product-quantity"><%= p.quantity %></td>
            <td>
              <% if (p.inventoryStatus) { %>
                <span class="inventory-badge <%= p.inventoryStatus.status %>">
                  <%= p.inventoryStatus.label %>
                </span>
              <% } %>
            </td>
            <% if (typeof user !== 'undefined' && user && user.role === 'admin') { %>
              <td>
                <div class="actions">
                  <a href="/edit/<%= p.id %>" class="btn btn-secondary" style="padding: 8px 16px; font-size: 14px;">‚úèÔ∏è S·ª≠a</a>
                  <form action="/delete/<%= p.id %>" method="post" style="display: inline;">
                    <button type="submit" class="btn btn-danger" style="padding: 8px 16px; font-size: 14px;" 
                            onclick="return confirm('B·∫°n c√≥ ch·∫Øc ch·∫Øn mu·ªën x√≥a s·∫£n ph·∫©m n√†y?')">üóëÔ∏è X√≥a</button>
                  </form>
                </div>
              </td>
            <% } %>
          </tr>
        <% }) %>
      </tbody>
    </table>
  </div>

  <!-- Pagination -->
  <% if (typeof pagination !== 'undefined' && pagination.hasMore) { %>
    <div class="pagination">
      <% if (pagination.page > 1) { %>
        <a href="?page=<%= pagination.page - 1 %>&<%= new URLSearchParams(filters || {}).toString() %>">¬´ Tr∆∞·ªõc</a>
      <% } %>
      <span>Trang <%= pagination.page %></span>
      <% if (pagination.hasMore) { %>
        <a href="?page=<%= pagination.page + 1 %>&<%= new URLSearchParams(filters || {}).toString() %>">Sau ¬ª</a>
      <% } %>
    </div>
  <% } %>
<% } %>

<%- include('../footer') %>
